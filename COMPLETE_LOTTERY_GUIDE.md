# 🎲 Discourse 抽奖插件完整使用指南

## 📖 目录
1. [功能概述](#功能概述)
2. [基本使用](#基本使用)
3. [参数详解](#参数详解)
4. [使用示例](#使用示例)
5. [界面展示](#界面展示)
6. [开奖方式](#开奖方式)
7. [管理员功能](#管理员功能)
8. [高级功能](#高级功能)
9. [最佳实践](#最佳实践)
10. [故障排除](#故障排除)

---

## 🎯 功能概述

这是一个功能完整的 Discourse 抽奖插件，支持：

### ✨ 核心功能
- 🎁 **灵活抽奖创建** - 支持各种参数配置
- 👥 **用户参与系统** - 积分消耗与防重复参与
- 🎲 **多种开奖方式** - 手动开奖 + 定时自动开奖
- 🏆 **多奖品支持** - 支持多个获奖者和排名系统
- 📊 **完整状态管理** - 活跃、已完成、已取消状态
- 🌍 **多语言支持** - 中英文界面
- 📱 **响应式设计** - 适配各种设备

---

## 📝 基本使用

### **创建抽奖的两种方式**

#### 1. 简单创建（默认设置）
```
[在此创建抽奖]
```
**效果：** 创建一个默认抽奖（5积分，50人限制，1个奖品）

#### 2. 自定义创建（推荐）
```
[lottery title="抽奖标题" prize="奖品名称" cost="积分" max="人数" count="奖品数" auto_draw="时间"]
```

---

## 🔧 参数详解

### **完整参数列表**

| 参数 | 别名 | 说明 | 示例 | 必填 | 默认值 |
|------|------|------|------|------|--------|
| `title` | `name` | 抽奖标题 | `title="新年大抽奖"` | ❌ | "社区抽奖" |
| `prize` | `reward` | 奖品名称 | `prize="iPhone 15 Pro"` | ❌ | "神秘奖品" |
| `cost` | `points` | 参与积分 | `cost="100"` | ❌ | 0 |
| `max` | `limit`, `max_entries` | 最大参与人数 | `max="50"` | ❌ | 无限制 |
| `count` | `prize_count`, `winners` | 奖品个数 | `count="3"` | ❌ | 1 |
| `auto_draw` | `draw_at`, `end_time` | 自动开奖时间 | `auto_draw="2h"` | ❌ | 无 |

### **时间参数格式**

#### 相对时间
- `"30s"` - 30秒后
- `"5m"` - 5分钟后  
- `"2h"` - 2小时后
- `"3d"` - 3天后

#### 绝对时间
- `"2024-12-25 18:00"` - 指定日期时间
- `"2024-12-25"` - 指定日期（默认23:59）

---

## 🎮 使用示例

### **1. 基础抽奖**
```
🎉 社区福利抽奖！

[lottery title="每日签到奖励" prize="100积分" cost="0" max="20"]

免费参与，每日限量20人！
```

### **2. 积分抽奖**
```
💎 高价值抽奖！

[lottery title="iPhone 15 Pro抽奖" prize="iPhone 15 Pro 256GB" cost="500" max="50"]

高价值奖品，需要500积分参与！
```

### **3. 定时抽奖**
```
⏰ 定时开奖活动！

[lottery title="晚间定时抽奖" prize="MacBook Pro" cost="200" auto_draw="2024-12-25 20:00"]

明天晚上8点准时开奖！
```

### **4. 多奖品抽奖**
```
🏆 多重大奖！

[lottery title="三重iPhone大奖" prize="iPhone 15 Pro" count="3" cost="300" max="100"]

3台iPhone等你来拿！
```

### **5. 限时多奖品抽奖**
```
⚡ 限时多重福利！

[lottery title="2小时限时十重奖" prize="现金红包" count="10" cost="50" auto_draw="2h"]

2小时后自动开奖，10个红包雨！
```

### **6. 免费大型活动**
```
🎁 新年回馈活动！

[lottery title="新年感谢抽奖" prize="精美周边礼品" count="20" cost="0" max="200" auto_draw="7d"]

免费参与，20份礼品，一周后开奖！
```

---

## 🖥️ 界面展示

### **单奖品抽奖界面**
```
┌─────────────────────────────────────┐
│ 🎉 iPhone 15 Pro抽奖                │
│                                     │
│ 奖品: iPhone 15 Pro 256GB           │
│ 参与人数: 25/50 (剩余 25 名额)      │
│ 消耗: 500 积分                      │
│                                     │
│ [参与抽奖 (500 积分)] [开奖]        │
│                                     │
└─────────────────────────────────────┘
```

### **多奖品抽奖界面**
```
┌─────────────────────────────────────┐
│ 🎉 三重iPhone大奖                   │
│                                     │
│ 奖品: iPhone 15 Pro (共3份)         │
│ 参与人数: 80/100 (剩余 20 名额)     │
│ 消耗: 300 积分                      │
│                                     │
│ ⏰ 自动开奖倒计时: 1h 23m 45s       │
│                                     │
│ [参与抽奖 (300 积分)] [开奖]        │
│                                     │
└─────────────────────────────────────┘
```

### **开奖后界面（多奖品）**
```
┌─────────────────────────────────────┐
│ 🎉 三重iPhone大奖                   │
│                                     │
│ 奖品: iPhone 15 Pro (共3份)         │
│ 参与人数: 100/100                   │
│ 消耗: 300 积分                      │
│                                     │
│ 🎉 恭喜以下 3 位获奖者！            │
│ ┌─────────────────────────────────┐ │
│ │ 第1名        @alice             │ │
│ │ 第2名        @bob               │ │
│ │ 第3名        @charlie           │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 开奖已完成                          │
└─────────────────────────────────────┘
```

---

## 🎲 开奖方式

### **1. 手动开奖**
- **操作者**: 管理员
- **方式**: 点击红色"开奖"按钮
- **条件**: 至少有1人参与
- **特点**: 即时开奖，完全控制

### **2. 自动开奖**
- **触发**: 到达设定时间
- **方式**: 系统后台自动执行
- **条件**: 有参与者且时间到达
- **特点**: 无需人工干预，精确定时

### **开奖流程**
1. 系统随机选择获奖者
2. 按选择顺序分配排名
3. 更新抽奖状态为"已完成"
4. 显示获奖者信息
5. 记录开奖时间和结果

---

## 🔧 管理员功能

### **开奖控制**
- ✅ **手动开奖** - 随时可以手动开奖
- ✅ **取消抽奖** - 取消未开奖的抽奖
- ✅ **查看状态** - 查看抽奖详细信息

### **权限要求**
- 只有管理员可以开奖
- 只有管理员可以取消抽奖
- 普通用户只能参与抽奖

### **API 接口**
```bash
# 手动开奖
POST /lottery_plugin/admin/draw/:lottery_id

# 取消抽奖  
POST /lottery_plugin/admin/cancel/:lottery_id

# 查看状态
GET /lottery_plugin/admin/status/:lottery_id
```

---

## 🚀 高级功能

### **1. 倒计时显示**
- 实时更新剩余时间
- 支持天、小时、分钟、秒
- 时间到后自动刷新页面
- 优雅的动画效果

### **2. 排名系统**
- 🥇 第1名 - 一等奖
- 🥈 第2名 - 二等奖  
- 🥉 第3名 - 三等奖
- 🏅 第4名+ - 第N名

### **3. 智能适配**
- 参与人数不足时全员获奖
- 自动防重复参与
- 积分不足时禁止参与
- 满员时自动停止参与

### **4. 状态管理**
- **active** - 可以参与和开奖
- **completed** - 已开奖，显示结果
- **cancelled** - 已取消，不可操作

---

## 📊 最佳实践

### **参数设置建议**

#### 积分设置
- **免费活动**: `cost="0"`
- **小型奖品**: `cost="10-50"`
- **中型奖品**: `cost="100-300"`
- **大型奖品**: `cost="500+"`

#### 人数限制
- **小型活动**: `max="10-30"`
- **中型活动**: `max="50-100"`
- **大型活动**: `max="200+"`

#### 奖品数量
- **单奖品**: `count="1"`（默认）
- **小型多奖品**: `count="3-5"`
- **中型多奖品**: `count="10-20"`
- **大型多奖品**: `count="50+"`

#### 时间设置
- **快速抽奖**: `auto_draw="30m-2h"`
- **日常抽奖**: `auto_draw="24h"`
- **周末活动**: `auto_draw="3d"`
- **特殊节日**: `auto_draw="2024-12-25 20:00"`

### **活动策划建议**

#### 1. 新手友好活动
```
[lottery title="新人欢迎抽奖" prize="新手礼包" cost="0" max="50" count="5"]
```

#### 2. 日常互动活动
```
[lottery title="每日签到奖励" prize="积分奖励" cost="10" max="20" auto_draw="24h"]
```

#### 3. 周末特别活动
```
[lottery title="周末大奖赛" prize="高级奖品" cost="200" max="100" count="3" auto_draw="3d"]
```

#### 4. 节日庆典活动
```
[lottery title="春节特别抽奖" prize="新年红包" cost="0" max="500" count="50" auto_draw="2024-02-10 00:00"]
```

---

## ⚠️ 注意事项

### **创建抽奖时**
1. 只能在主题的第一个帖子中创建
2. 每个帖子只能创建一个抽奖
3. 参数值必须用引号包围
4. 时间格式要正确

### **参与抽奖时**
1. 需要足够的积分（如果设置了cost）
2. 不能重复参与同一个抽奖
3. 需要在人数限制内参与
4. 抽奖必须处于活跃状态

### **开奖相关**
1. 至少需要1人参与才能开奖
2. 手动开奖会取消自动开奖
3. 开奖后不能撤销
4. 获奖者按随机选择顺序排名

---

## 🛠️ 故障排除

### **常见问题**

#### Q: 抽奖没有显示？
A: 检查以下几点：
- 插件是否已启用
- 语法是否正确
- 是否在主题第一个帖子中
- 刷新页面重试

#### Q: 无法参与抽奖？
A: 可能的原因：
- 积分不足
- 已经参与过
- 抽奖已满员
- 抽奖已结束

#### Q: 自动开奖没有执行？
A: 检查以下：
- 时间格式是否正确
- 是否有参与者
- 服务器时间是否正确
- 后台任务是否正常

#### Q: 开奖按钮不显示？
A: 确认以下：
- 当前用户是否为管理员
- 抽奖是否有参与者
- 抽奖状态是否为活跃

### **技术支持**
如遇到其他问题，请检查：
1. Discourse 版本兼容性（需要 >= 2.8.0.beta10）
2. 服务器日志错误信息
3. 浏览器控制台错误
4. 插件文件完整性

---

## 🎉 总结

这个抽奖插件为您提供了：

- 🎯 **灵活的配置选项** - 满足各种抽奖需求
- 🎲 **多种开奖方式** - 手动和自动开奖
- 🏆 **完整的多奖品支持** - 支持多个获奖者
- ⏰ **智能定时功能** - 精确的自动开奖
- 🎨 **优雅的用户界面** - 现代化设计
- 🌍 **国际化支持** - 多语言界面
- 🔧 **强大的管理功能** - 完整的后台控制

现在您可以创建各种类型的抽奖活动，从简单的日常互动到复杂的节日庆典，这个插件都能完美支持！

**开始创建您的第一个抽奖吧！** 🚀

---

## 📚 附录

### **A. 快速参考卡片**

#### 基本语法
```
[lottery title="标题" prize="奖品" cost="积分" max="人数" count="数量" auto_draw="时间"]
```

#### 常用模板
```bash
# 免费单奖品
[lottery title="每日福利" prize="积分奖励" cost="0" max="20"]

# 付费单奖品
[lottery title="iPhone抽奖" prize="iPhone 15" cost="500" max="50"]

# 定时多奖品
[lottery title="周末三重奖" prize="礼品" count="3" auto_draw="3d"]

# 限时多奖品
[lottery title="限时十重奖" prize="红包" count="10" auto_draw="2h"]
```

### **B. 时间格式速查表**

| 格式 | 说明 | 示例 |
|------|------|------|
| `Ns` | N秒后 | `30s`, `300s` |
| `Nm` | N分钟后 | `5m`, `30m` |
| `Nh` | N小时后 | `1h`, `24h` |
| `Nd` | N天后 | `1d`, `7d` |
| `YYYY-MM-DD HH:MM` | 绝对时间 | `2024-12-25 20:00` |
| `YYYY-MM-DD` | 日期 | `2024-12-25` |

### **C. 错误代码说明**

| 错误信息 | 原因 | 解决方案 |
|----------|------|----------|
| "积分不足" | 用户积分少于required | 获取更多积分或降低cost |
| "已参与过" | 重复参与 | 每人只能参与一次 |
| "抽奖已满" | 达到max_entries | 等待其他抽奖或提高限制 |
| "抽奖已结束" | 状态非active | 抽奖已完成或取消 |
| "权限不足" | 非管理员开奖 | 需要管理员权限 |

### **D. 性能优化建议**

#### 大型抽奖活动
- 合理设置参与人数上限
- 避免过多的同时进行的抽奖
- 定期清理已完成的抽奖数据

#### 服务器配置
- 确保后台任务正常运行
- 监控数据库性能
- 定期备份抽奖数据

### **E. 安全注意事项**

#### 防作弊措施
- 系统自动防重复参与
- 使用安全的随机算法
- 完整的操作日志记录

#### 数据保护
- 获奖者信息安全存储
- 操作权限严格控制
- 敏感数据加密处理

---

## 🔗 相关链接

- **插件源码**: [GitHub Repository]
- **问题反馈**: [Issues Page]
- **功能建议**: [Feature Requests]
- **社区讨论**: [Community Forum]

---

## 📄 版本历史

### v1.0.9 (当前版本)
- ✅ 基础抽奖功能
- ✅ 用户参与系统
- ✅ 手动开奖功能
- ✅ 定时自动开奖
- ✅ 多奖品支持
- ✅ 排名系统
- ✅ 多语言支持
- ✅ 响应式界面

### 计划功能
- 📧 获奖者邮件通知
- 📊 抽奖统计报告
- 🎁 奖品分类管理
- 📱 移动端APP支持
- 🔔 实时推送通知

---

*最后更新: 2024年12月*
*文档版本: v1.0*
