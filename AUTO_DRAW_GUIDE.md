# ⏰ 定时自动开奖功能指南

## 🎯 功能概述

现在您的抽奖插件支持定时自动开奖功能！可以设置一个时间，到时间后系统会自动开奖并选择获奖者。

## 📝 使用方法

### **基本语法**
```
[lottery title="抽奖标题" prize="奖品" cost="积分" max="人数" auto_draw="时间"]
```

### **时间参数格式**

#### **1. 相对时间（推荐）**
```
auto_draw="2h"     # 2小时后自动开奖
auto_draw="30m"    # 30分钟后自动开奖
auto_draw="3d"     # 3天后自动开奖
auto_draw="300s"   # 300秒后自动开奖
```

#### **2. 绝对时间**
```
auto_draw="2024-12-25 18:00"    # 指定日期和时间
auto_draw="2024-12-25"          # 指定日期（默认23:59）
```

## 🎮 完整示例

### **示例1：2小时后自动开奖**
```
🎉 限时抽奖活动！

[lottery title="限时iPhone抽奖" prize="iPhone 15 Pro" cost="50" max="100" auto_draw="2h"]

本次抽奖将在2小时后自动开奖，请抓紧时间参与！
```

### **示例2：明天晚上8点自动开奖**
```
📅 定时大抽奖！

[lottery title="每日定时抽奖" prize="MacBook Pro" cost="100" max="50" auto_draw="2024-12-25 20:00"]

明天晚上8点准时开奖，不见不散！
```

### **示例3：30分钟快速抽奖**
```
⚡ 快速抽奖！

[lottery title="闪电抽奖" prize="100元红包" cost="10" max="20" auto_draw="30m"]

30分钟后自动开奖，先到先得！
```

## 🖥️ 界面显示

### **倒计时显示**
当设置了自动开奖时间，抽奖框会显示实时倒计时：

```
┌─────────────────────────────────────┐
│ 🎉 限时iPhone抽奖                   │
│                                     │
│ 奖品: iPhone 15 Pro                 │
│ 参与人数: 25/100 (剩余 75 名额)     │
│ 消耗: 50 积分                       │
│                                     │
│ ⏰ 自动开奖倒计时: 1h 23m 45s       │
│                                     │
│ [参与抽奖 (50 积分)] [开奖]         │
│                                     │
└─────────────────────────────────────┘
```

### **时间到后的显示**
```
┌─────────────────────────────────────┐
│ 🎉 限时iPhone抽奖                   │
│                                     │
│ 奖品: iPhone 15 Pro                 │
│ 参与人数: 100/100                   │
│ 消耗: 50 积分                       │
│                                     │
│ ⏰ 时间到！正在自动开奖...          │
│                                     │
│ 🎉 恭喜 @username 获奖！            │
│                                     │
└─────────────────────────────────────┘
```

## ⚙️ 技术特性

### **自动开奖机制**
- ✅ 使用 Discourse 后台任务系统
- ✅ 精确到秒的定时执行
- ✅ 自动处理时区转换
- ✅ 失败重试机制

### **倒计时功能**
- ✅ 实时更新倒计时显示
- ✅ 支持天、小时、分钟、秒显示
- ✅ 时间到后自动刷新页面
- ✅ 优雅的动画效果

### **安全保障**
- ✅ 只有在有参与者时才会自动开奖
- ✅ 抽奖状态检查防止重复开奖
- ✅ 详细的日志记录
- ✅ 错误处理和恢复

## 📋 时间格式详解

### **相对时间格式**
| 格式 | 说明 | 示例 |
|------|------|------|
| `Ns` | N秒后 | `300s` = 5分钟后 |
| `Nm` | N分钟后 | `30m` = 30分钟后 |
| `Nh` | N小时后 | `2h` = 2小时后 |
| `Nd` | N天后 | `3d` = 3天后 |

### **绝对时间格式**
| 格式 | 说明 | 示例 |
|------|------|------|
| `YYYY-MM-DD HH:MM` | 完整日期时间 | `2024-12-25 18:00` |
| `YYYY-MM-DD` | 日期（默认23:59） | `2024-12-25` |

## ⚠️ 注意事项

### **时间设置**
1. **最短时间**: 建议不少于1分钟
2. **最长时间**: 建议不超过30天
3. **时区**: 使用服务器时区
4. **格式**: 严格按照格式要求

### **自动开奖条件**
1. ✅ 抽奖状态为"活跃"
2. ✅ 至少有一个参与者
3. ✅ 到达设定时间
4. ✅ 系统正常运行

### **特殊情况处理**
- **无参与者**: 不会自动开奖
- **已手动开奖**: 取消自动开奖
- **系统重启**: 自动恢复定时任务
- **时间已过**: 立即执行开奖

## 🔧 管理员功能

### **手动开奖优先**
- 管理员可以在自动开奖前手动开奖
- 手动开奖后会取消自动开奖任务

### **查看定时状态**
- 在抽奖界面可以看到倒计时
- 管理面板可以查看所有定时抽奖

## 🚀 高级用法

### **组合使用**
```
[lottery title="新年大抽奖" prize="iPhone + MacBook" cost="200" max="50" auto_draw="2024-01-01 00:00"]
```

### **批量定时抽奖**
可以创建多个不同时间的抽奖：
```
[lottery title="上午场" prize="奖品A" auto_draw="2h"]
[lottery title="下午场" prize="奖品B" auto_draw="6h"]
[lottery title="晚上场" prize="奖品C" auto_draw="10h"]
```

## 📊 使用建议

### **最佳实践**
1. **提前通知**: 在抽奖开始时告知自动开奖时间
2. **合理时长**: 给用户足够的参与时间
3. **明确规则**: 说明自动开奖的条件和流程
4. **及时跟进**: 开奖后及时联系获奖者

### **常见场景**
- **限时促销**: 30分钟-2小时
- **每日抽奖**: 24小时
- **周末活动**: 2-3天
- **节日特别**: 指定节日时间

---

🎉 **现在您可以创建各种定时自动开奖活动了！**
